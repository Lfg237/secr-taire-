<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Programme des Matchs A6</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<style>
body {
    margin: 0;
    padding: 10px;
    font-family: Arial, sans-serif;
    background: #e1ecff;
}
.page {
    width: 420px; /* A6 width */
    height: 595px; /* A6 height */
    margin: auto;
    position: relative;
    background: white;
    padding: 15px;
    border-radius: 10px;
    box-shadow: 0 0 15px rgba(0,0,0,0.2);
    overflow: hidden;
}
#backgroundPhoto {
    position: absolute;
    top:0;
    left:0;
    width:100%;
    height:100%;
    object-fit: cover;
    z-index:0;
}

.header {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
    position: relative;
    z-index: 2;
}

.header .title {
    flex: 1;
}

.header h1, .header h2 {
    margin: 0;
}
.header h1 { font-size: 18px; }
.header h2 { font-size: 12px; color:#555; }

#logoBox {
    width: 60px;
    height: 60px;
    border: 2px dashed #999;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    border-radius: 5px;
    background: white;
}

button {
    padding: 5px 8px;
    margin: 5px 5px 10px 0;
    border-radius: 5px;
    border: none;
    cursor: pointer;
    z-index: 2;
    position: relative;
    background-color: rgba(255,255,255,0.9);
    font-weight: bold;
    font-size: 12px;
}

/* ... autres styles restent identiques ... */

table {
    width: 100%;
    border-collapse: collapse;
    z-index: 2;
    position: relative;
    background-color: rgba(255,255,255,0.85);
    font-size: 12px; /* augmentée pour meilleure lisibilité */
}

th, td {
    border: 1px solid #ddd;
    padding: 5px; /* augmenté */
    text-align: center;
    height: 25px; /* hauteur plus grande */
}

th { 
    background: #10b981; 
    color:white; 
    font-size: 12px; /* taille titre colonnes */
}
#paymentPopup {
    display:none;
    position:fixed;
    top:0; left:0;
    width:100%; height:100%;
    background: rgba(0,0,0,0.5);
    justify-content:center;
    align-items:center;
    z-index: 5;
}

#paymentPopup .popup-content {
    background:white;
    padding:15px;
    border-radius:10px;
    width:250px;
    text-align:center;
}

#paymentPopup textarea, #paymentPopup input { width:100%; margin-bottom:10px; }

.signature {
    margin-top: 15px;
    font-size: 10px;
    text-align: center;
    color: #555;
    position: relative;
    z-index: 2;
}
</style>
</head>
<body>

<div class="page" id="pageContent">
    <img id="backgroundPhoto" src="" alt="Photo de fond">

    <div class="header">
        <div class="title">
            <h1 contenteditable="true">Nom de l'entreprise</h1>
            <h2 contenteditable="true">Programme des Matchs 2025</h2>
        </div>
        <div id="logoBox">Logo
            <input type="file" id="logoInput" accept="image/*" style="display:none;">
        </div>
    </div>

    <button id="addMatchBtn">Ajouter Match</button>
    <button id="downloadBtn">Télécharger PDF</button>

    <table id="matchesTable">
        <tr>
            <th>Equipe A</th>
            <th>Equipe B</th>
            <th>Date</th>
            <th>Heure</th>
            <th>Lieu</th>
            <th>Organisateur</th>
        </tr>
        <tr contenteditable="true">
            <td>Team 1</td>
            <td>Team 2</td>
            <td>12/04/2025</td>
            <td>16:00</td>
            <td>Stade Central</td>
            <td>Ligue Locale</td>
        </tr>
    </table>

    <div class="signature">
        Créé par LesFacilitateurs WhatsApp : +237651475255
    </div>
</div>

<!-- Popup paiement -->
<div id="paymentPopup">
    <div class="popup-content">
        <h3>Paiement HelepMoney</h3>
        <p>Effectuez votre paiement de 100 FCFA à :</p>
        <ul style="text-align:left;">
            <li>Kono Emini Michel - MoMo : 651475255</li>
            <li>Kono Emini Michel - OM : 656050097</li>
        </ul>
        <p>Ou utilisez le code admin :</p>
        <input type="text" id="adminCode" placeholder="Code admin">
        <textarea id="transactionMsg" placeholder="Collez le message Momo ici"></textarea>
        <button id="validateBtn">Valider</button>
        <button id="cancelPopup">Annuler</button>
        <p id="paymentError" style="color:red; font-size:12px;"></p>
    </div>
</div>

<script>
// Logo carré
const logoBox = document.getElementById('logoBox');
const logoInput = document.getElementById('logoInput');
logoBox.addEventListener('click', ()=> logoInput.click());
logoInput.addEventListener('change', e=>{
    const file = e.target.files[0];
    if(file){
        const reader = new FileReader();
        reader.onload = e=>{
            logoBox.innerHTML = `<img src="${e.target.result}" style="width:100%; height:100%; object-fit:cover;">`;
        }
        reader.readAsDataURL(file);
    }
});

// Photo de fond
const backgroundPhoto = document.getElementById('backgroundPhoto');
backgroundPhoto.addEventListener('click', ()=>{
    const file = document.createElement('input');
    file.type='file'; file.accept='image/*';
    file.onchange = e=>{
        const reader = new FileReader();
        reader.onload = ev=>{ backgroundPhoto.src = ev.target.result; }
        reader.readAsDataURL(e.target.files[0]);
    };
    file.click();
});

// Ajouter match
const addMatchBtn = document.getElementById('addMatchBtn');
addMatchBtn.addEventListener('click', ()=>{
    const table = document.getElementById('matchesTable');
    const row = table.insertRow();
    row.contentEditable = "true";
    for(let i=0;i<6;i++) row.insertCell();
});

// Paiement PDF
const downloadBtn = document.getElementById('downloadBtn');
const popup = document.getElementById('paymentPopup');
const cancelPopup = document.getElementById('cancelPopup');
const validateBtn = document.getElementById('validateBtn');
const adminCode = document.getElementById('adminCode');
const transactionMsg = document.getElementById('transactionMsg');
const paymentError = document.getElementById('paymentError');

const validUsers = [
    {name:"Kono Emini Michel", momo:"651475255"},
    {name:"Kono Emini Michel", momo:"656050097"}
];
const VIP_CODE = "233233";
let usedIds = [];

downloadBtn.addEventListener('click', ()=> popup.style.display='flex');
cancelPopup.addEventListener('click', ()=>{
    popup.style.display='none';
    paymentError.textContent=''; adminCode.value=''; transactionMsg.value='';
});

validateBtn.addEventListener('click', ()=>{
    const code = adminCode.value.trim();
    const msg = transactionMsg.value.trim();
    paymentError.textContent='';

    if(code===VIP_CODE){ popup.style.display='none'; downloadPDF(); return; }

    const regex = /a\s(.+)\s\((\d+)\)\sId:(\d+)\sle\s([\d-]+\s[\d:]+)/i;
    const match = msg.match(regex);
    if(!match){ paymentError.textContent="Format invalide"; return; }
    const [_, name, momo, txnId, dateStr] = match;
    const txnDate = new Date(dateStr);
    const now = new Date();
    if(now - txnDate > 10*60*1000){ paymentError.textContent="Transaction trop ancienne"; return; }
    if(!validUsers.find(u=>u.name===name && u.momo===momo)){ paymentError.textContent="Nom ou numéro invalide"; return; }
    if(usedIds.includes(txnId)){ paymentError.textContent="Transaction déjà utilisée"; return; }
    usedIds.push(txnId);
    popup.style.display='none';
    downloadPDF();
});

function downloadPDF(){
    const element = document.getElementById('pageContent');
    html2pdf().set({
        filename:'Programme_Matchs_A6.pdf',
        pagebreak: {mode:['avoid-all']},
        margin:0.5
    }).from(element).save();
}
</script>
</body>
</html>